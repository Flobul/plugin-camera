<div class="eqLogic eqLogic-widget allowResize" data-eqLogic_id="#id#" data-eqLogic_uid="#uid#" data-version="#version#" style="min-width : 150px;min-height : 180px ;border:#border#;border-radius:#border-radius#;background-color: #background-color#;color: #color#;width: #width#;height: #height#;#style#">
  <span class="statusCmd" style="float:left;margin-top: 3px;margin-right: 3px;"></span>
  <center>
    <span style="font-size: 1.5em;#hideEqLogicName#"><a href="#eqLink#">#name_display# <span style="font-size: 0.85em;">#object_name#</span></a></span>
  </center>
  <center>
    <span class="directDisplay zoom cursor"><img src="plugins/camera/core/img/no-image-blanc.png" style="display:block;" data-eqLogic_id="#id#"/></span>
    <span style="position:relative;top:4px;width:100%;">
     <center>
       <span>#info#</span>
     </center>
     <center>
       <span>#action#</span>
       <span class="cmd cmd-widget" data-type="action" data-subtype="other">
        <a class="camera_history btn btn-default btn-sm folder" data-eqLogic_id="#id#" style="background-color:#cmd-background-color# !important;border-color : transparent !important;"><i class="fa fa-folder-open"></i></a>
      </span>
    </center>
  </span>
</center>
<div class="md_cameraZoom" data-eqLogic_uid="#uid#" data-eqLogic_id="#id#" title="#name_display#">
  <center>
    <div class="display"><img src="plugins/camera/core/img/no-image-noir.png" class="img-responsive" data-eqLogic_id="#id#" /></div>
    <br/>#action#
  </center>
</div>
<script>
 $('.eqLogic[data-eqLogic_id=#id#] .cmd[data-cmd_id=#cmd_off_id#]').hide();
 if ($(".md_cameraZoom[data-eqLogic_uid=#uid#]").length > 1) {
  while ($(".md_cameraZoom[data-eqLogic_uid=#uid#]").length > 1) {
    $(".md_cameraZoom[data-eqLogic_uid=#uid#]").eq(0).remove();
  }
}
$('.eqLogic[data-eqLogic_id=#id#] .directDisplay img').css('max-height',$('.eqLogic[data-eqLogic_id=#id#]').height() - 60);
$('.eqLogic[data-eqLogic_id=#id#] .directDisplay img').css('max-width',$('.eqLogic[data-eqLogic_id=#id#]').width());
$('.eqLogic[data-eqLogic_id=#id#]').off('resize').on('resize',function(){
  $('.eqLogic[data-eqLogic_id=#id#] .directDisplay img').css('max-height',$('.eqLogic[data-eqLogic_id=#id#]').height() - 60);
  $('.eqLogic[data-eqLogic_id=#id#] .directDisplay img').css('max-width',$('.eqLogic[data-eqLogic_id=#id#]').width());
});
$('.camera_history[data-eqLogic_id=#id#]').off().on('click', function () {
  $('#md_modal').dialog({title: "Historique #name#"});
  $('#md_modal').load('index.php?v=d&plugin=camera&modal=camera.history&id=#id#').dialog('open');
});
$(".md_cameraZoom[data-eqLogic_id=#id#]").dialog({
  autoOpen: false,
  modal: true,
  resizable: false,
  closeText: '',
  height: ((jQuery(window).height() - 100) < 780) ? jQuery(window).height() - 100 : 780,
  width: ((jQuery(window).width() - 100) < 1280) ? (jQuery(window).width() - 100) : 1280,
  open: function () {
    $("body").css({overflow: 'hidden'});
    $(".md_cameraZoom[data-eqLogic_uid=#uid#] .display img").height($(".md_cameraZoom[data-eqLogic_uid=#uid#]").height() - 50);
    if (typeof timeoutCamera#id# !== "undefined") {
      clearTimeout(timeoutCamera#id#);
    }
    refreshImgCam#id#();
  },
  beforeClose: function (event, ui) {
    $("body").css({overflow: 'inherit'});
  }
});

$('.eqLogic[data-eqLogic_id=#id#]').undelegate('.zoom', 'click').delegate('.zoom', 'click', function () {
  $(".md_cameraZoom[data-eqLogic_uid=#uid#]").dialog("open");
});

function refreshImgCam#id#(){
  if($('.eqLogic[data-eqLogic_uid=#uid#]').html() == undefined){
    return;
  }
  if(!$(".md_cameraZoom[data-eqLogic_uid=#uid#]").is(':visible') && $(".md_cameraZoom").is(':visible')){
   timeoutCamera#id# =  setTimeout(refreshImgCam#id#,#refreshDelaySlow#);
   return;
 }
 var thumbnail = !$(".md_cameraZoom[data-eqLogic_uid=#uid#]").is(':visible');
 var start = Date.now();
 var url = "#url#";
 url += (url.indexOf('?') > 0) ? '&t='+(new Date()).getTime() : '?t='+(new Date()).getTime();
 url += (thumbnail)?  '&thumbnail=1&width='+ $('.eqLogic[data-eqLogic_id=#id#] .directDisplay img').width():'&width='+$(".md_cameraZoom[data-eqLogic_id=#id#] .display img").width();

 var img = new Image();
 img.src = url;
 img.onload = function() {
  if(thumbnail){
   $('.eqLogic[data-eqLogic_id=#id#] .directDisplay img').attr('src',img.src);
 }else{
  $(".md_cameraZoom[data-eqLogic_id=#id#] .display img").attr('src',img.src);
}
if('#cmd_off_id#' != '""' && '#cmd_on_id#' != '""'){
  $('.eqLogic[data-eqLogic_id=#id#] .cmd[data-cmd_id=#cmd_off_id#]').show();
  $('.eqLogic[data-eqLogic_id=#id#] .cmd[data-cmd_id=#cmd_on_id#]').hide();
}
var delay = (thumbnail) ? #refreshDelaySlow# - (Date.now() - start) :  #refreshDelayFast# - (Date.now() - start);
timeoutCamera#id# =  setTimeout(refreshImgCam#id#,delay);
};
img.onerror = function() {
 $(".md_cameraZoom[data-eqLogic_id=#id#] .display img").attr('src','plugins/camera/core/img/no-image-noir.png');
 $('.eqLogic[data-eqLogic_id=#id#] .directDisplay img').attr('src','plugins/camera/core/img/no-image-blanc.png');
 if('#cmd_off_id#' != '""' && '#cmd_on_id#' != '""'){
  $('.eqLogic[data-eqLogic_id=#id#] .cmd[data-cmd_id=#cmd_off_id#]').hide();
  $('.eqLogic[data-eqLogic_id=#id#] .cmd[data-cmd_id=#cmd_on_id#]').show();
}
timeoutCamera#id# = setTimeout(refreshImgCam#id#, #refreshDelaySlow# * 2);
};
}
if (typeof timeoutCamera#id# !== "undefined") {
  clearTimeout(timeoutCamera#id#);
}
setTimeout(refreshImgCam#id#,50);
</script>
</div>
